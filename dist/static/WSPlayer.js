!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("WSPlayer",[],t):"object"==typeof exports?exports.WSPlayer=t():e.WSPlayer=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(1),s=r(2),a=n(r(3)),c=n(r(4)),u=function(e){function t(e){var r=e.container,n=e.webgl,i=void 0===n?"auto":n,o=e.useWorker,s=void 0===o||o,a=e.workerFile,u=void 0===a?"/static/Decoder.js":a,h=e.debug,f=void 0!==h&&h;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var l=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));l.container=r,l.webgl=i,l.workerFile=u,l.debug=f,l.KFCFlag=!1,l.ws=null,l.timer=null,l.timer2=null,l.now=null,l.runing=!1,l.player=new c.default({useWorker:"undefined"!=typeof Worker&&s,workerFile:u,webgl:i,debug:f,reuseMemory:!0,transferMemory:!0});var v=l.KFCFlag;return l.player.onPictureDecoded=function(e,t,r,n){var i=void 0;if(l.fps++,n)try{i=n[n.length-1].KFCFlag}catch(e){i=!1}else i=!1;!v&&i?l.emit("loading",!0):v&&!i&&l.emit("loading",!1),v=i},l.container.appendChild(l.player.canvas),l.log=function(){var e;l.debug&&(e=console).log.apply(e,arguments)},l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.EventEmitter),i(t,[{key:"decode",value:function(e,t){e.length>4&&(101===e[4]||(65===e[4]||(103===e[4]||e[4]))),this.player.decode(e,t)}},{key:"connect",value:function(e){var t=this;null!==this.ws&&this.ws.close(),this.fps=0,this.timer2=setInterval(function(){t.emit("fps",t.fps),t.fps=0},1e3),this.ws=new a.default(e,{autoOpen:!0,smartSend:!0,autoReconnect:!0,reconnectDelay:500,maxReconnectCount:10}),this.now=Date.now(),this.send("heart"),this.runing=!0,this.ws.addEventListener("open",function(r){var n=r.reconnectCount;t.ws.socket.binaryType="arraybuffer",n<=0?(t.log("Connected to "+e),t.emit("connected",e)):(t.log("Reconnect:"+n),t.emit("reconnected",n))}),this.framesList=[],this.ws.addEventListener("message",function(e){if("string"==typeof e.data)return t.cmd(JSON.parse(e.data));var r=new Uint8Array(e.data);t.KFCFlag?t.decode(r,{KFCFlag:!0}):t.framesList.push(r)});return function e(){if(t.runing){if(t.framesList.length>=12){var r=(0,o.findLastIndex)(t.framesList,function(e){return 7==(31&e[4])});r>=0&&(t.log("Dropping frames",r+1),t.framesList=t.framesList.slice(r))}var n=t.framesList.shift();t.debug&&t.emit("frame_shift",t.framesList.length),n&&t.decode(n),requestAnimationFrame(e)}}(),this.ws.addEventListener("close",function(){t.emit("disconnected"),t.log("Connection closed")}),this.ws}},{key:"cmd",value:function(e){var t=this;switch(e.action){case"initalize":return this.emit("initalized",e.payload);case"KFC":return this.KFCFlag=e.payload,this.emit("KFC",e.payload);case"heart":return this.emit("delay",Date.now()-this.now),void(this.timer=setTimeout(function(){t.now=Date.now(),t.send("heart")},3e3));default:return this.emit(e.action,e.payload)}}},{key:"disconnect",value:function(){this.ws.close(),this.timer&&clearTimeout(this.timer),this.timer2&&clearInterval(this.timer2),this.runing=!1}},{key:"destroy",value:function(){this.disconnect(),this.container.removeChild(this.player.canvas)}},{key:"send",value:function(e,t){return this.ws.send(JSON.stringify({action:e,payload:t}))}}]),t}();e.exports=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findLastIndex=function(e,t){for(var r=e.length-1;r>=0;r--)if(t(e[r]))return r;return-1}},function(e,t,r){"use strict";function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"object"===(void 0===e?"undefined":a(e))&&null!==e}function s(e){return void 0===e}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!function(e){return"number"==typeof e}(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,r,n,a,c,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var h=new Error('Uncaught, unspecified "error" event. ('+t+")");throw h.context=t,h}if(r=this._events[e],s(r))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),r.apply(this,a)}else if(o(r))for(a=Array.prototype.slice.call(arguments,1),n=(u=r.slice()).length,c=0;c<n;c++)u[c].apply(this,a);return!0},n.prototype.addListener=function(e,t){var r;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(r=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var n=!1;return r.listener=t,this.on(e,r),this},n.prototype.removeListener=function(e,t){var r,n,s,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],s=r.length,n=-1,r===t||i(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(r)){for(a=s;a-- >0;)if(r[a]===t||r[a].listener&&r[a].listener===t){n=a;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],i(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,r){"use strict";function n(e,t){var r=new CustomEvent(e);return o(r,t),r}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s=function(){function e(t){var r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=i.autoOpen,s=void 0===o||o,a=i.smartSend,c=void 0===a||a,u=i.autoReconnect,h=void 0===u||u,f=i.reconnectDelay,l=void 0===f?500:f,v=i.maxReconnectCount,d=void 0===v?3:v;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._url=t,this._autoOpen=s,this._smartSend=c,this._autoReconnect=h,this._reconnectDelay=l,this._maxReconnectCount=d,this._reconnectCount=0,this._forceClose=!1,this._bus=document.createElement("div"),this.socket=null,this.addEventListener=this._bus.addEventListener.bind(this._bus),this.removeEventListener=this._bus.removeEventListener.bind(this._bus);this._autoReconnect&&this.addEventListener("close",function(){r._forceClose?(r._forceClose=!1,r._reconnectCount=0):(r._reconnectCount+=1,r._reconnectCount>r._maxReconnectCount?(r._bus.dispatchEvent(n("reconnectStopped",{reconnectCount:r._reconnectCount})),r._reconnectCount=0):setTimeout(function(){r.open()},r._reconnectDelay))}),this._autoOpen&&this.open()}return i(e,[{key:"open",value:function(){var e=this;this.socket&&1===this.socket.readyState||(this.socket=new WebSocket(this._url),this._bus.dispatchEvent(n("connecting",{reconnectCount:this._reconnectCount})),this.socket.addEventListener("open",function(){e._bus.dispatchEvent(n("open",{reconnectCount:e._reconnectCount})),e._reconnectCount=0}),this.socket.addEventListener("message",function(t){var r=t.data,i=t.origin,o=t.lastEventId,s=t.source,a=t.ports;e._bus.dispatchEvent(n("message",{reconnectCount:e._reconnectCount,data:r,origin:i,lastEventId:o,source:s,ports:a}))}),this.socket.addEventListener("close",function(t){var r=t.code,i=t.reason,o=t.wasClean;e._bus.dispatchEvent(n("close",{reconnectCount:e._reconnectCount,code:r,reason:i,wasClean:o}))}),this.socket.addEventListener("error",function(){e._bus.dispatchEvent(n("error",{reconnectCount:e._reconnectCount}))}))}},{key:"close",value:function(){this.socket&&(this._forceClose=!0,this.socket.close())}},{key:"send",value:function(e){var t=this;!this.socket||0===this.socket.readyState&&this._smartSend?this.addEventListener("open",function(){t.socket.send(e)},{once:!0}):this.socket.send(e)}}]),e}();t.default=s},function(e,t,r){"use strict";function n(e){function t(e,t,n,i){r.onPictureDecoded(e,t,n,i);s();e&&r.render&&(i&&i[0]&&i[0].KFCFlag||(r.renderFrame({canvasObj:r.canvasObj,data:e,width:t,height:n}),r.onRenderFrameComplete&&r.onRenderFrameComplete({data:e,width:t,height:n,infos:i,canvasObj:r.canvasObj})))}var r=this;this._config=e||{},this.render=!0,!1===this._config.render&&(this.render=!1),this.nowValue=s,this._config.workerFile=this._config.workerFile||"Decoder.js",this._config.preserveDrawingBuffer&&(this._config.contextOptions=this._config.contextOptions||{},this._config.contextOptions.preserveDrawingBuffer=!0);var n="auto";if(!0===this._config.webgl?n=!0:!1===this._config.webgl&&(n=!1),"auto"===n){n=!0;try{if(window.WebGLRenderingContext){document.createElement("canvas").getContext("webgl")||(n=!1)}else n=!1}catch(e){n=!1}}this.webgl=n,this._config.debug&&console.log("use webgl: "+this.webgl),this.webgl?(this.createCanvasObj=this.createCanvasWebGL,this.renderFrame=this.renderFrameWebGL):(this.createCanvasObj=this.createCanvasRGB,this.renderFrame=this.renderFrameRGB);if(this._config.size||(this._config.size={}),this._config.size.width=this._config.size.width||200,this._config.size.height=this._config.size.height||200,this._config.debug&&console.log("use worker: "+this._config.useWorker),this._config.useWorker){var i=new Worker(this._config.workerFile);this.worker=i,i.addEventListener("message",function(e){var n=e.data;n.consoleLog?console.log(n.consoleLog):t.call(r,new Uint8Array(n.buf,0,n.length),n.width,n.height,n.infos)},!1),i.postMessage({type:"Broadway.js - Worker init",options:{rgb:!n,memsize:this.memsize,reuseMemory:!!this._config.reuseMemory}}),this._config.transferMemory?this.decode=function(e,t){i.postMessage({buf:e.buffer,offset:e.byteOffset,length:e.length,info:t},[e.buffer])}:this.decode=function(e,t){var r=new Uint8Array(e.length);r.set(e,0,e.length),i.postMessage({buf:r.buffer,offset:0,length:e.length,info:t},[r.buffer])},this._config.reuseMemory&&(this.recycleMemory=function(e){i.postMessage({reuse:e.buffer},[e.buffer])})}else this.decoder=new o({rgb:!n}),this.decoder.onPictureDecoded=t,this.decode=function(e,t){r.decoder.decode(e,t)};this.render&&(this.canvasObj=this.createCanvasObj({contextOptions:this._config.contextOptions}),this.canvas=this.canvasObj.canvas),this.domNode=this.canvas,this._config.size.width,this._config.size.height}Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return e&&e.__esModule?e:{default:e}}(r(5)),o=window.Decoder,s=o.nowValue;n.prototype={onPictureDecoded:function(e,t,r,n){},recycleMemory:function(e){},createCanvasWebGL:function(e){var t=this._createBasicCanvasObj(e);return t.contextOptions=e.contextOptions,t},createCanvasRGB:function(e){return this._createBasicCanvasObj(e)},_createBasicCanvasObj:function(e){var t={},r=(e=e||{}).width;r||(r=this._config.size.width);var n=e.height;return n||(n=this._config.size.height),t.canvas=document.createElement("canvas"),t.canvas.width=r,t.canvas.height=n,t.canvas.style.width="100%",t.canvas.style.height="100%",t.canvas.style.backgroundColor="#0D0E1B",t},renderFrameWebGL:function(e){var t=e.canvasObj,r=e.width||t.canvas.width,n=e.height||t.canvas.height;t.canvas.width===r&&t.canvas.height===n&&t.webGLCanvas||(t.canvas.width=r,t.canvas.height=n,t.webGLCanvas=new i.default({canvas:t.canvas,contextOptions:t.contextOptions,width:r,height:n}));var o=r*n,s=r/2*(n/2);t.webGLCanvas.drawNextOutputPicture({yData:e.data.subarray(0,o),uData:e.data.subarray(o,o+s),vData:e.data.subarray(o+s,o+s+s)});this.recycleMemory(e.data)},renderFrameRGB:function(e){var t=e.canvasObj,r=e.width||t.canvas.width,n=e.height||t.canvas.height;t.canvas.width===r&&t.canvas.height===n||(t.canvas.width=r,t.canvas.height=n);var i=t.ctx,o=t.imgData;i||(t.ctx=t.canvas.getContext("2d"),i=t.ctx,t.imgData=i.createImageData(r,n),o=t.imgData),o.data.set(e.data),i.putImageData(o,0,0);this.recycleMemory(e.data)}},t.default=n},function(e,t,r){"use strict";function n(e){e=e||{},this.canvasElement=e.canvas||document.createElement("canvas"),this.contextOptions=e.contextOptions,this.type=e.type||"yuv420",this.customYUV444=e.customYUV444,this.conversionType=e.conversionType||"rec601",this.width=e.width||640,this.height=e.height||320,this.animationTime=e.animationTime||0,this.canvasElement.width=this.width,this.canvasElement.height=this.height,this.initContextGL(),this.contextGL&&(this.initProgram(),this.initBuffers(),this.initTextures()),"yuv420"===this.type?this.drawNextOuptutPictureGL=function(e){var t=this.contextGL,r=this.texturePosBuffer,n=this.uTexturePosBuffer,i=this.vTexturePosBuffer,o=this.yTextureRef,s=this.uTextureRef,a=this.vTextureRef,c=e.yData,u=e.uData,h=e.vData,f=this.width,l=this.height,v=e.yDataPerRow||f,d=e.yRowCnt||l,p=e.uDataPerRow||f/2,g=e.uRowCnt||l/2,m=e.vDataPerRow||p,_=e.vRowCnt||g;t.viewport(0,0,f,l);var y=l/d,x=f/v,b=new Float32Array([x,0,0,0,x,y,0,y]);t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,b,t.DYNAMIC_DRAW),this.customYUV444?(y=l/g,x=f/p):(y=l/2/g,x=f/2/p);var E=new Float32Array([x,0,0,0,x,y,0,y]);t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,E,t.DYNAMIC_DRAW),this.customYUV444?(y=l/_,x=f/m):(y=l/2/_,x=f/2/m);var w=new Float32Array([x,0,0,0,x,y,0,y]);t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,w,t.DYNAMIC_DRAW),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,v,d,0,t.LUMINANCE,t.UNSIGNED_BYTE,c),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,p,g,0,t.LUMINANCE,t.UNSIGNED_BYTE,u),t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,m,_,0,t.LUMINANCE,t.UNSIGNED_BYTE,h),t.drawArrays(t.TRIANGLE_STRIP,0,4)}:"yuv422"===this.type&&(this.drawNextOuptutPictureGL=function(e){var t=this.contextGL,r=this.texturePosBuffer,n=this.textureRef,i=e.data,o=this.width,s=this.height,a=e.dataPerRow||2*o,c=e.rowCnt||s;t.viewport(0,0,o,s);var u=s/c,h=o/(a/2),f=new Float32Array([h,0,0,0,h,u,0,u]);t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,f,t.DYNAMIC_DRAW),t.uniform2f(t.getUniformLocation(this.shaderProgram,"resolution"),a,s),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,a,c,0,t.LUMINANCE,t.UNSIGNED_BYTE,i),t.drawArrays(t.TRIANGLE_STRIP,0,4)})}Object.defineProperty(t,"__esModule",{value:!0}),n.prototype.isWebGL=function(){return this.contextGL},n.prototype.initContextGL=function(){for(var e=this.canvasElement,t=null,r=["webgl","experimental-webgl","moz-webgl","webkit-3d"],n=0;!t&&n<r.length;){var i=r[n];try{t=this.contextOptions?e.getContext(i,this.contextOptions):e.getContext(i)}catch(e){t=null}t&&"function"==typeof t.getParameter||(t=null),++n}this.contextGL=t},n.prototype.initProgram=function(){var e=this.contextGL,t=void 0,r=void 0;"yuv420"===this.type?(t=["attribute vec4 vertexPos;","attribute vec4 texturePos;","attribute vec4 uTexturePos;","attribute vec4 vTexturePos;","varying vec2 textureCoord;","varying vec2 uTextureCoord;","varying vec2 vTextureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos.xy;","  uTextureCoord = uTexturePos.xy;","  vTextureCoord = vTexturePos.xy;","}"].join("\n"),r=["precision highp float;","varying highp vec2 textureCoord;","varying highp vec2 uTextureCoord;","varying highp vec2 vTextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","uniform mat4 YUV2RGB;","void main(void) {","  highp float y = texture2D(ySampler,  textureCoord).r;","  highp float u = texture2D(uSampler,  uTextureCoord).r;","  highp float v = texture2D(vSampler,  vTextureCoord).r;","  gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;","}"].join("\n")):"yuv422"===this.type&&(t=["attribute vec4 vertexPos;","attribute vec4 texturePos;","varying vec2 textureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos.xy;","}"].join("\n"),r=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D sampler;","uniform highp vec2 resolution;","uniform mat4 YUV2RGB;","void main(void) {","  highp float texPixX = 1.0 / resolution.x;","  highp float logPixX = 2.0 / resolution.x;","  highp float logHalfPixX = 4.0 / resolution.x;","  highp float steps = floor(textureCoord.x / logPixX);","  highp float uvSteps = floor(textureCoord.x / logHalfPixX);","  highp float y = texture2D(sampler, vec2((logPixX * steps) + texPixX, textureCoord.y)).r;","  highp float u = texture2D(sampler, vec2((logHalfPixX * uvSteps), textureCoord.y)).r;","  highp float v = texture2D(sampler, vec2((logHalfPixX * uvSteps) + texPixX + texPixX, textureCoord.y)).r;","  gl_FragColor = vec4(y, u, v, 1.0) * YUV2RGB;","}"].join("\n"));var n=[];n="rec709"==this.conversionType?[1.16438,0,1.79274,-.97295,1.16438,-.21325,-.53291,.30148,1.16438,2.1124,0,-1.1334,0,0,0,1]:[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1];var i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,t),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)||console.log("Vertex shader failed to compile: "+e.getShaderInfoLog(i));var o=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(o,r),e.compileShader(o),e.getShaderParameter(o,e.COMPILE_STATUS)||console.log("Fragment shader failed to compile: "+e.getShaderInfoLog(o));var s=e.createProgram();e.attachShader(s,i),e.attachShader(s,o),e.linkProgram(s),e.getProgramParameter(s,e.LINK_STATUS)||console.log("Program failed to compile: "+e.getProgramInfoLog(s)),e.useProgram(s);var a=e.getUniformLocation(s,"YUV2RGB");e.uniformMatrix4fv(a,!1,n),this.shaderProgram=s},n.prototype.initBuffers=function(){var e=this.contextGL,t=this.shaderProgram,r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),e.STATIC_DRAW);var n=e.getAttribLocation(t,"vertexPos");if(e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),this.animationTime){var i=this.animationTime,o=0;!function r(){o+=15;var n=Number(o)/i;o>=i?n=1:setTimeout(r,15);var s=-1*n,a=Number(n),c=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,c),e.bufferData(e.ARRAY_BUFFER,new Float32Array([a,a,s,a,a,s,s,s]),e.STATIC_DRAW);var u=e.getAttribLocation(t,"vertexPos");e.enableVertexAttribArray(u),e.vertexAttribPointer(u,2,e.FLOAT,!1,0,0);try{e.drawArrays(e.TRIANGLE_STRIP,0,4)}catch(e){}}()}var s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var a=e.getAttribLocation(t,"texturePos");if(e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0),this.texturePosBuffer=s,"yuv420"===this.type){var c=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,c),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var u=e.getAttribLocation(t,"uTexturePos");e.enableVertexAttribArray(u),e.vertexAttribPointer(u,2,e.FLOAT,!1,0,0),this.uTexturePosBuffer=c;var h=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,h),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var f=e.getAttribLocation(t,"vTexturePos");e.enableVertexAttribArray(f),e.vertexAttribPointer(f,2,e.FLOAT,!1,0,0),this.vTexturePosBuffer=h}},n.prototype.initTextures=function(){var e=this.contextGL,t=this.shaderProgram;if("yuv420"===this.type){var r=this.initTexture(),n=e.getUniformLocation(t,"ySampler");e.uniform1i(n,0),this.yTextureRef=r;var i=this.initTexture(),o=e.getUniformLocation(t,"uSampler");e.uniform1i(o,1),this.uTextureRef=i;var s=this.initTexture(),a=e.getUniformLocation(t,"vSampler");e.uniform1i(a,2),this.vTextureRef=s}else if("yuv422"===this.type){var c=this.initTexture(),u=e.getUniformLocation(t,"sampler");e.uniform1i(u,0),this.textureRef=c}},n.prototype.initTexture=function(){var e=this.contextGL,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),t},n.prototype.drawNextOutputPicture=function(e,t,r,n){this.contextGL?this.drawNextOuptutPictureGL(e,t,r,n):this.drawNextOuptutPictureRGBA(e,t,r,n)},n.prototype.drawNextOuptutPictureRGBA=function(e,t,r,n){var i=n,o=this.canvasElement.getContext("2d"),s=o.getImageData(0,0,e,t);s.data.set(i),o.putImageData(s,0,0)},t.default=n}])});